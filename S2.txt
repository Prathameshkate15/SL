SET foreign_key_checks=0;
DROP TABLE IF EXISTS branch;
DROP TABLE IF EXISTS customer;
DROP TABLE IF EXISTS account;
DROP TABLE IF EXISTS loan;
DROP TABLE IF EXISTS depositor;
DROP TABLE IF EXISTS borrower;
SET foreign_key_checks=1;

CREATE TABLE branch (
    branch_name VARCHAR(100) PRIMARY KEY,
    branch_city VARCHAR(100) NOT NULL,
    assets DECIMAL(12, 2)
);

CREATE TABLE customer (
    cust_name VARCHAR(100) PRIMARY KEY,
    cust_street VARCHAR(100),
    cust_city VARCHAR(100)
);

CREATE TABLE account (
    acc_no VARCHAR(20) PRIMARY KEY,
    branch_name VARCHAR(100),
    balance DECIMAL(10, 2) NOT NULL,
    FOREIGN KEY (branch_name) REFERENCES branch(branch_name)
);

CREATE TABLE loan (
    loan_no VARCHAR(20) PRIMARY KEY,
    branch_name VARCHAR(100),
    amount DECIMAL(10, 2) NOT NULL,
    FOREIGN KEY (branch_name) REFERENCES branch(branch_name)
);

CREATE TABLE depositor (
    cust_name VARCHAR(100),
    acc_no VARCHAR(20),
    PRIMARY KEY (cust_name, acc_no),
    FOREIGN KEY (cust_name) REFERENCES customer(cust_name),
    FOREIGN KEY (acc_no) REFERENCES account(acc_no)
);

CREATE TABLE borrower (
    cust_name VARCHAR(100),
    loan_no VARCHAR(20),
    PRIMARY KEY (cust_name, loan_no),
    FOREIGN KEY (cust_name) REFERENCES customer(cust_name),
    FOREIGN KEY (loan_no) REFERENCES loan(loan_no)
);

INSERT INTO branch VALUES ('Wadia College Branch', 'Pune', 7500000);
INSERT INTO branch VALUES ('MG Road', 'Mumbai', 9000000);
INSERT INTO branch VALUES ('Deccan', 'Pune', 8200000);

-- Data for S2 Queries:
-- Rahul: Account + Loan
-- Priya: Account + Loan
-- Amit: Account + Loan
-- Sneha: Account only
-- Rohan: Loan only

INSERT INTO customer VALUES ('Rahul', '123 Main St', 'Pune');
INSERT INTO customer VALUES ('Priya', '456 Oak Ave', 'Mumbai');
INSERT INTO customer VALUES ('Amit', '789 Pine Ln', 'Pune');
INSERT INTO customer VALUES ('Sneha', '321 Elm Blvd', 'Delhi');
INSERT INTO customer VALUES ('Rohan', '654 Maple Dr', 'Pune');

INSERT INTO account VALUES ('A-201', 'Wadia College Branch', 22000);
INSERT INTO account VALUES ('A-202', 'MG Road', 30000);
INSERT INTO account VALUES ('A-203', 'Deccan', 5000);
INSERT INTO account VALUES ('A-204', 'Wadia College Branch', 7000);
INSERT INTO depositor VALUES ('Rahul', 'A-201');
INSERT INTO depositor VALUES ('Priya', 'A-202');
INSERT INTO depositor VALUES ('Amit', 'A-203');
INSERT INTO depositor VALUES ('Sneha', 'A-204');

INSERT INTO loan VALUES ('L-101', 'Wadia College Branch', 15000);
INSERT INTO loan VALUES ('L-102', 'MG Road', 25000);
INSERT INTO loan VALUES ('L-103', 'Deccan', 10000);
INSERT INTO loan VALUES ('L-105', 'Wadia College Branch', 20000);
INSERT INTO borrower VALUES ('Rahul', 'L-101');
INSERT INTO borrower VALUES ('Priya', 'L-102');
INSERT INTO borrower VALUES ('Amit', 'L-103');
INSERT INTO borrower VALUES ('Rohan', 'L-105');

-- 1. Find all customers who have both account and loan at bank.
SELECT cust_name
FROM depositor
WHERE cust_name IN (SELECT cust_name FROM borrower);

-- 2. Find all customers who have an account or loan or both at bank.
(SELECT cust_name FROM depositor)
UNION
(SELECT cust_name FROM borrower);

-- 3. Find all customers who have account but no loan at the bank.
SELECT cust_name
FROM depositor
WHERE cust_name NOT IN (SELECT cust_name FROM borrower);

-- 4. Find average account balance at 'Wadia College' branch.
SELECT AVG(balance)
FROM account
WHERE branch_name = 'Wadia College Branch';

-- 5. Find no. of depositors at each branch.
SELECT a.branch_name, COUNT(d.cust_name)
FROM depositor d
JOIN account a ON d.acc_no = a.acc_no
GROUP BY a.branch_name;


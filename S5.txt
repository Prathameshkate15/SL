SET foreign_key_checks=0;
DROP TABLE IF EXISTS Manages;
DROP TABLE IF EXISTS Works;
DROP TABLE IF EXISTS Employee;
DROP TABLE IF EXISTS Company;
SET foreign_key_checks=1;

-- 1. CREATE TABLES
CREATE TABLE Employee (
    emp_id VARCHAR(10) PRIMARY KEY,
    employee_name VARCHAR(100) UNIQUE NOT NULL,
    street VARCHAR(100),
    city VARCHAR(100)
);

CREATE TABLE Company (
    company_name VARCHAR(100) PRIMARY KEY,
    city VARCHAR(100)
);

CREATE TABLE Works (
    employee_name VARCHAR(100) PRIMARY KEY,
    company_name VARCHAR(100),
    salary DECIMAL(10, 2),
    FOREIGN KEY (employee_name) REFERENCES Employee(employee_name),
    FOREIGN KEY (company_name) REFERENCES Company(company_name)
);

CREATE TABLE Manages (
    employee_name VARCHAR(100) PRIMARY KEY,
    manager_name VARCHAR(100),
    FOREIGN KEY (employee_name) REFERENCES Employee(employee_name)
);

-- 2. INSERT DATA
INSERT INTO Employee VALUES ('E101', 'Amit', '123 Main St', 'Pune');
INSERT INTO Employee VALUES ('E102', 'Rahul', '456 Oak Ave', 'Mumbai');
INSERT INTO Employee VALUES ('E103', 'Priya', '789 Pine Ln', 'Banglore');
INSERT INTO Employee VALUES ('E104', 'Sneha', '321 Elm Blvd', 'Delhi');
INSERT INTO Employee VALUES ('E105', 'Rohan', '654 Maple Dr', 'Pune');

INSERT INTO Company VALUES ('TCS', 'Pune');
INSERT INTO Company VALUES ('InfoSys', 'Mumbai');
INSERT INTO Company VALUES ('TechM', 'Banglore');

INSERT INTO Works VALUES ('Amit', 'TCS', 8000);
INSERT INTO Works VALUES ('Rahul', 'InfoSys', 12000);
INSERT INTO Works VALUES ('Priya', 'TechM', 15000);
INSERT INTO Works VALUES ('Sneha', 'TechM', 9000);
INSERT INTO Works VALUES ('Rohan', 'TCS', 7500);

INSERT INTO Manages VALUES ('Amit', 'Mr. Sharma');
INSERT INTO Manages VALUES ('Rahul', 'Mr. Gupta');

-- 3. RUN S5 QUERIES
-- 1. Find the names of all employees who work for 'TCS'.
SELECT employee_name FROM Works WHERE company_name = 'TCS';

-- 2. Find the names and company names of all employees sorted
--    in ascending order of company name and descending order of employee names.
SELECT employee_name, company_name
FROM Works
ORDER BY company_name ASC, employee_name DESC;

-- 3. Change the city of employee working with InfoSys to 'Bangalore'.
UPDATE Employee
SET city = 'Bangalore'
WHERE employee_name IN (
    SELECT employee_name FROM (
        SELECT employee_name FROM Works WHERE company_name = 'InfoSys'
    ) AS temp
);

-- 4. Find the names, street address, and cities of residence for all
--    employees who work for 'TechM' and earn more than $10,000.
SELECT e.employee_name, e.street, e.city
FROM Employee e
JOIN Works w ON e.employee_name = w.employee_name
WHERE w.company_name = 'TechM' AND w.salary > 10000;

-- 5. Add Column Asset to Company table.
ALTER TABLE Company ADD COLUMN Asset DECIMAL(15, 2);

-- 4. VERIFICATION
-- Check if Rahul's city is now Bangalore
SELECT * FROM Employee WHERE employee_name = 'Rahul';

-- Check if Asset column was added
DESCRIBE Company;
